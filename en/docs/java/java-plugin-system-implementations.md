---
title: "Java plugin system implementations"
slug: "java-plugin-system-implementations"
draft: false
images: []
weight: 9983
type: docs
toc: true
---

If you use an IDE and/or build system, it is much easier to set up this kind of project. You create a main application module, then API module, then create a plugin module and make it dependent on the API module or both. Next, you configure where the project artifacts are to be put - in our case the compiled plugin jars can be sent straight to 'plugins' directory, thus avoiding doing manual movement.

## Using URLClassLoader
There are several ways to implement a plugin system for a Java application. One of the simplest is to use *URLClassLoader*. The following example will involve a bit of JavaFX code.

Suppose we have a module of a main application. This module is supposed to load plugins in form of Jars from 'plugins' folder. Initial code:

    package main;
    
    public class MainApplication extends Application
    {
        @Override
        public void start(Stage primaryStage) throws Exception
        {
            File pluginDirectory=new File("plugins"); //arbitrary directory
            if(!pluginDirectory.exists())pluginDirectory.mkdir();
            VBox loadedPlugins=new VBox(6); //a container to show the visual info later
            Rectangle2D screenbounds=Screen.getPrimary().getVisualBounds();
            Scene scene=new Scene(loadedPlugins,screenbounds.getWidth()/2,screenbounds.getHeight()/2);
            primaryStage.setScene(scene);
            primaryStage.show();
        }
        public static void main(String[] a)
        {
                launch(a);
        }
    }

Then, we create an interface which will represent a plugin.

    package main;
    
    public interface Plugin
    {
        default void initialize()
        {
            System.out.println("Initialized "+this.getClass().getName());
        }
        default String name(){return getClass().getSimpleName();}
    }

We want to load classes which implement this interface, so first we need to filter files which have a '.jar' extension:

    File[] files=pluginDirectory.listFiles((dir, name) -> name.endsWith(".jar"));
If there are any files, we need to create collections of URLs and class names:

        if(files!=null && files.length>0)
        {
            ArrayList<String> classes=new ArrayList<>();
            ArrayList<URL> urls=new ArrayList<>(files.length);
            for(File file:files)
            {
                JarFile jar=new JarFile(file);
                jar.stream().forEach(jarEntry -> {
                    if(jarEntry.getName().endsWith(".class"))
                    {
                        classes.add(jarEntry.getName());
                    }
                });
                URL url=file.toURI().toURL();
                urls.add(url);
            }
            
        }
Let's add a static HashSet to *MainApplication* which will hold loaded plugins:

    static HashSet<Plugin> plugins=new HashSet<>();
Next, we instantiate a *URLClassLoader*, and iterate over class names, instantiating classes which implement *Plugin* interface:

    URLClassLoader urlClassLoader=new URLClassLoader(urls.toArray(new URL[urls.size()]));
    classes.forEach(className->{
        try
        {
            Class cls=urlClassLoader.loadClass(className.replaceAll("/",".").replace(".class","")); //transforming to binary name
            Class[] interfaces=cls.getInterfaces();
            for(Class intface:interfaces)
            {
                if(intface.equals(Plugin.class)) //checking presence of Plugin interface
                {
                    Plugin plugin=(Plugin) cls.newInstance(); //instantiating the Plugin
                    plugins.add(plugin);
                    break;
                }
            }
        }
        catch (Exception e){e.printStackTrace();}
    });
Then, we can call plugin's methods, for example, to initialize them:

    if(!plugins.isEmpty())loadedPlugins.getChildren().add(new Label("Loaded plugins:"));
        plugins.forEach(plugin -> {
            plugin.initialize();
            loadedPlugins.getChildren().add(new Label(plugin.name()));
    });

The final code of *MainApplication*:

    package main;
    public class MainApplication extends Application
    {
        static HashSet<Plugin> plugins=new HashSet<>();
        @Override
        public void start(Stage primaryStage) throws Exception
        {
            File pluginDirectory=new File("plugins");
            if(!pluginDirectory.exists())pluginDirectory.mkdir();
            File[] files=pluginDirectory.listFiles((dir, name) -> name.endsWith(".jar"));
            VBox loadedPlugins=new VBox(6);
            loadedPlugins.setAlignment(Pos.CENTER);
            if(files!=null && files.length>0)
            {
                ArrayList<String> classes=new ArrayList<>();
                ArrayList<URL> urls=new ArrayList<>(files.length);
                for(File file:files)
                {
                    JarFile jar=new JarFile(file);
                    jar.stream().forEach(jarEntry -> {
                        if(jarEntry.getName().endsWith(".class"))
                        {
                            classes.add(jarEntry.getName());
                        }
                    });
                    URL url=file.toURI().toURL();
                    urls.add(url);
                }
                URLClassLoader urlClassLoader=new URLClassLoader(urls.toArray(new URL[urls.size()]));
                classes.forEach(className->{
                    try
                    {
                        Class cls=urlClassLoader.loadClass(className.replaceAll("/",".").replace(".class",""));
                        Class[] interfaces=cls.getInterfaces();
                        for(Class intface:interfaces)
                        {
                            if(intface.equals(Plugin.class))
                            {
                                Plugin plugin=(Plugin) cls.newInstance();
                                plugins.add(plugin);
                                break;
                            }
                        }
                    }
                    catch (Exception e){e.printStackTrace();}
                });
                if(!plugins.isEmpty())loadedPlugins.getChildren().add(new Label("Loaded plugins:"));
                plugins.forEach(plugin -> {
                    plugin.initialize();
                    loadedPlugins.getChildren().add(new Label(plugin.name()));
                });
            }
            Rectangle2D screenbounds=Screen.getPrimary().getVisualBounds();
            Scene scene=new Scene(loadedPlugins,screenbounds.getWidth()/2,screenbounds.getHeight()/2);
            primaryStage.setScene(scene);
            primaryStage.show();
        }
        public static void main(String[] a)
        {
                launch(a);
        }
    }
Let's create two plugins. Obviously, the plugin's source should be in a separate module.

    package plugins;
    
    import main.Plugin;
    
    public class FirstPlugin implements Plugin
    {
        //this plugin has default behaviour
    }

Second plugin:

    package plugins;
    
    import main.Plugin;
    
    public class AnotherPlugin implements Plugin
    {
        @Override
        public void initialize() //overrided to show user's home directory
        {
            System.out.println("User home directory: "+System.getProperty("user.home"));
        }
    }

These plugins have to be packaged into standard Jars - this process depends on your IDE or other tools.

When Jars will be put into 'plugins' directly, *MainApplication* will detect them and instantiate appropriate classes.

